//---------------------------------------------------------------------------
#include <vcl.h>
#include <string>
#include <string.h>
#include <iostream>

#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
using namespace std;
TForm1 *Form1;

AnsiString s;
AnsiString new_s;
AnsiString key;
int k=0;

AnsiString new_alphabet;
AnsiString alphabet="абвгдеёжзийклмнопрстуфхцчшщъыьэюя";
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::LabeledEdit1Change(TObject *Sender)
{
s=LabeledEdit1->Text;
}
//---------------------------------------------------------------------------
void __fastcall TForm1::LabeledEdit3Change(TObject *Sender)
{
 s=LabeledEdit3->Text;
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button3Click(TObject *Sender)
{
	key="";
	s="";
	new_s="";
	LabeledEdit1->Text="";
	LabeledEdit2->Text="";
	LabeledEdit5->Text="";
    LabeledEdit7->Text="";
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button4Click(TObject *Sender)
{   key="";
	s="";
	new_s="";
	LabeledEdit3->Text="";
	LabeledEdit4->Text="";
	LabeledEdit6->Text="";
	LabeledEdit8->Text="";
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button1Click(TObject *Sender)
{ 	// Зашифровать
	new_s = "";
	new_alphabet = "";
	AnsiString used="";
	for (size_t j = 1; j <= key.Length(); j++) {
		char d = key[j];
		if (used.Pos(d) == 0) {
			new_alphabet += d;
			used += d;
        }
    }

    for (size_t i = 1; i <= alphabet.Length(); i++) {
        char c = alphabet[i];
		if (used.Pos(c) == 0) {
			new_alphabet += c;
			used += c;
        }
    }
	//ShowMessage("Новый алфавит с вcтавленным ключевым словом: "+new_alphabet);

    k=k%new_alphabet.Length();
	new_alphabet = new_alphabet.SubString(new_alphabet.Length()-k+1, new_alphabet.Length()) + new_alphabet.SubString(1, new_alphabet.Length()-k);
	ShowMessage("Конечный новый алфавит: "+new_alphabet) ;


	// Шифруем текст
    for (size_t i = 1; i <= s.Length(); i++) {
		char c = s[i];
		new_s += new_alphabet[alphabet.Pos(c)];
    }
	LabeledEdit5->Text = new_s;
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button2Click(TObject *Sender)
{
//расшифровать
if (flag==False) {
  Button2->Enabled=TRUE;
  }
  new_s = "";
  new_alphabet = "";
	AnsiString used="";
	for (size_t j = 1; j <= key.Length(); j++) {
		char d = key[j];
		if (used.Pos(d) == 0) {
			new_alphabet += d;
			used += d;
        }
    }

    for (size_t i = 1; i <= alphabet.Length(); i++) {
        char c = alphabet[i];
		if (used.Pos(c) == 0) {
			new_alphabet += c;
			used += c;
        }
    }
	//ShowMessage("Новый алфавит с вcтавленным ключевым словом: "+new_alphabet);

    k=k%new_alphabet.Length();
	new_alphabet = new_alphabet.SubString(new_alphabet.Length()-k+1, new_alphabet.Length()) + new_alphabet.SubString(1, new_alphabet.Length()-k);
	//ShowMessage("Конечный новый алфавит: "+new_alphabet) ;


	// Расшифровываем текст
    for (size_t i = 1; i <= s.Length(); i++) {
		char c = s[i];
		new_s += alphabet[new_alphabet.Pos(c)];
	}
  LabeledEdit6->Text = new_s; // Выводим расшифрованный текст
}
//---------------------------------------------------------------------------
void __fastcall TForm1::LabeledEdit2Change(TObject *Sender)
{
key=LabeledEdit2->Text;
}
//---------------------------------------------------------------------------

void __fastcall TForm1::LabeledEdit4Change(TObject *Sender)
{
 key=LabeledEdit4->Text;
}
//---------------------------------------------------------------------------

void __fastcall TForm1::LabeledEdit7Change(TObject *Sender)
{
	k=StrToInt(LabeledEdit7->Text);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::LabeledEdit8Change(TObject *Sender)
{
	k=StrToInt(LabeledEdit8->Text);
}
//---------------------------------------------------------------------------

